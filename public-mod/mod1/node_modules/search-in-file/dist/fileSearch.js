"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.readFileAndSearch = exports.search = void 0;
const fs_1 = require("fs");
const readline_1 = require("readline");
/**
 * Method to search the given text in the given data.
 *
 * @param {string} data Data on which search will be performed.
 * @param {string} textToSearch Text to search in file.
 * @param {object} options Various options for file search.
 * @returns {boolean} Returns true is text is present in given data. Else returns false
 */
const search = (data, textToSearch, options) => {
    if (!options || !(options instanceof Object)) {
        options = {};
    }
    if (options.words) {
        options.isRegex = true;
        textToSearch = `\\b${textToSearch}\\b`;
    }
    if (options.isRegex) {
        let regexOptions = 'g';
        if (options.ignoreCase) {
            regexOptions += 'i';
        }
        return new RegExp(textToSearch, regexOptions).test(data);
    }
    else {
        if (options.ignoreCase) {
            data = data.toLowerCase();
            textToSearch = textToSearch.toLowerCase();
        }
        return data.includes(textToSearch);
    }
};
exports.search = search;
/**
 * Method to read the given file and search for the given text line by line.
 *
 * @param {string} filePath Path of the file to search.
 * @param {string} textToSearch Text to search in file.
 * @param {object} options Various options for file search.
 * @returns {promise} Returns a promise that resolves with path of file, line and line number in which the given text is present.
 */
const searchLineByLine = (filePath, textToSearch, options) => {
    return new Promise((resolve, reject) => {
        const results = [];
        const stream = (0, fs_1.createReadStream)(filePath, { encoding: 'utf-8' });
        const lineReader = (0, readline_1.createInterface)({
            input: stream,
        });
        let lineNo = 0;
        lineReader.on('line', (line) => {
            lineNo++;
            if ((0, exports.search)(line, textToSearch, options)) {
                results.push({ filePath, line: line.trim(), lineNo });
            }
        });
        lineReader.on('close', () => {
            resolve(results);
        });
        lineReader.on('error', (err) => {
            stream.close();
            reject(err);
        });
    });
};
/**
 * Method to read the given file and search for the given text.
 *
 * @param {string} filePath Path of the file to search.
 * @param {string} textToSearch Text to search in file.
 * @param {object} options Various options for file search.
 * @returns {promise} Returns a promise that resolves with path of file in which the given text is present.
 */
const readFileAndSearch = (filePath, textToSearch, options) => {
    if (!options.searchResults || options.searchResults !== 'lineNo') {
        return new Promise((resolve, reject) => {
            const readStream = (0, fs_1.createReadStream)(filePath, { encoding: 'utf-8' });
            readStream.on('data', (data) => {
                const result = (0, exports.search)(data.toString(), textToSearch, options);
                if (result) {
                    resolve(filePath);
                    readStream.close();
                }
            });
            readStream.on('error', (err) => {
                readStream.close();
                reject(err);
            });
            readStream.on('close', resolve);
        });
    }
    return searchLineByLine(filePath, textToSearch, options);
};
exports.readFileAndSearch = readFileAndSearch;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsZVNlYXJjaC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9maWxlU2VhcmNoLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDJCQUFzQztBQUN0Qyx1Q0FBMkM7QUFHM0M7Ozs7Ozs7R0FPRztBQUNJLE1BQU0sTUFBTSxHQUFHLENBQUMsSUFBWSxFQUFFLFlBQW9CLEVBQUUsT0FBc0IsRUFBRSxFQUFFO0lBQ25GLElBQUksQ0FBQyxPQUFPLElBQUksQ0FBQyxDQUFDLE9BQU8sWUFBWSxNQUFNLENBQUMsRUFBRSxDQUFDO1FBQzdDLE9BQU8sR0FBRyxFQUFFLENBQUM7SUFDZixDQUFDO0lBQ0QsSUFBSSxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDbEIsT0FBTyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFDdkIsWUFBWSxHQUFHLE1BQU0sWUFBWSxLQUFLLENBQUM7SUFDekMsQ0FBQztJQUNELElBQUksT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ3BCLElBQUksWUFBWSxHQUFHLEdBQUcsQ0FBQztRQUN2QixJQUFJLE9BQU8sQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUN2QixZQUFZLElBQUksR0FBRyxDQUFDO1FBQ3RCLENBQUM7UUFDRCxPQUFPLElBQUksTUFBTSxDQUFDLFlBQVksRUFBRSxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDM0QsQ0FBQztTQUFNLENBQUM7UUFDTixJQUFJLE9BQU8sQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUN2QixJQUFJLEdBQUcsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQzFCLFlBQVksR0FBRyxZQUFZLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDNUMsQ0FBQztRQUNELE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUNyQyxDQUFDO0FBQ0gsQ0FBQyxDQUFDO0FBckJXLFFBQUEsTUFBTSxVQXFCakI7QUFFRjs7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dGVSZWFkU3RyZWFtIH0gZnJvbSAnZnMnO1xyXG5pbXBvcnQgeyBjcmVhdGVJbnRlcmZhY2UgfSBmcm9tICdyZWFkbGluZSc7XHJcbmltcG9ydCB7IExpbmVSZXN1bHQsIFNlYXJjaE9wdGlvbnMgfSBmcm9tICcuL3R5cGVzJztcclxuXHJcbi8qKlxyXG4gKiBNZXRob2QgdG8gc2VhcmNoIHRoZSBnaXZlbiB0ZXh0IGluIHRoZSBnaXZlbiBkYXRhLlxyXG4gKlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gZGF0YSBEYXRhIG9uIHdoaWNoIHNlYXJjaCB3aWxsIGJlIHBlcmZvcm1lZC5cclxuICogQHBhcmFtIHtzdHJpbmd9IHRleHRUb1NlYXJjaCBUZXh0IHRvIHNlYXJjaCBpbiBmaWxlLlxyXG4gKiBAcGFyYW0ge29iamVjdH0gb3B0aW9ucyBWYXJpb3VzIG9wdGlvbnMgZm9yIGZpbGUgc2VhcmNoLlxyXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyB0cnVlIGlzIHRleHQgaXMgcHJlc2VudCBpbiBnaXZlbiBkYXRhLiBFbHNlIHJldHVybnMgZmFsc2VcclxuICovXHJcbmV4cG9ydCBjb25zdCBzZWFyY2ggPSAoZGF0YTogc3RyaW5nLCB0ZXh0VG9TZWFyY2g6IHN0cmluZywgb3B0aW9uczogU2VhcmNoT3B0aW9ucykgPT4ge1xyXG4gIGlmICghb3B0aW9ucyB8fCAhKG9wdGlvbnMgaW5zdGFuY2VvZiBPYmplY3QpKSB7XHJcbiAgICBvcHRpb25zID0ge307XHJcbiAgfVxyXG4gIGlmIChvcHRpb25zLndvcmRzKSB7XHJcbiAgICBvcHRpb25zLmlzUmVnZXggPSB0cnVlO1xyXG4gICAgdGV4dFRvU2VhcmNoID0gYFxcXFxiJHt0ZXh0VG9TZWFyY2h9XFxcXGJgO1xyXG4gIH1cclxuICBpZiAob3B0aW9ucy5pc1JlZ2V4KSB7XHJcbiAgICBsZXQgcmVnZXhPcHRpb25zID0gJ2cnO1xyXG4gICAgaWYgKG9wdGlvbnMuaWdub3JlQ2FzZSkge1xyXG4gICAgICByZWdleE9wdGlvbnMgKz0gJ2knO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG5ldyBSZWdFeHAodGV4dFRvU2VhcmNoLCByZWdleE9wdGlvbnMpLnRlc3QoZGF0YSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGlmIChvcHRpb25zLmlnbm9yZUNhc2UpIHtcclxuICAgICAgZGF0YSA9IGRhdGEudG9Mb3dlckNhc2UoKTtcclxuICAgICAgdGV4dFRvU2VhcmNoID0gdGV4dFRvU2VhcmNoLnRvTG93ZXJDYXNlKCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZGF0YS5pbmNsdWRlcyh0ZXh0VG9TZWFyY2gpO1xyXG4gIH1cclxufTtcclxuXHJcbi8qKlxyXG4gKiBNZXRob2QgdG8gcmVhZCB0aGUgZ2l2ZW4gZmlsZSBhbmQgc2VhcmNoIGZvciB0aGUgZ2l2ZW4gdGV4dCBsaW5lIGJ5IGxpbmUuXHJcbiAqXHJcbiAqIEBwYXJhbSB7c3RyaW5nfSBmaWxlUGF0aCBQYXRoIG9mIHRoZSBmaWxlIHRvIHNlYXJjaC5cclxuICogQHBhcmFtIHtzdHJpbmd9IHRleHRUb1NlYXJjaCBUZXh0IHRvIHNlYXJjaCBpbiBmaWxlLlxyXG4gKiBAcGFyYW0ge29iamVjdH0gb3B0aW9ucyBWYXJpb3VzIG9wdGlvbnMgZm9yIGZpbGUgc2VhcmNoLlxyXG4gKiBAcmV0dXJucyB7cHJvbWlzZX0gUmV0dXJucyBhIHByb21pc2UgdGhhdCByZXNvbHZlcyB3aXRoIHBhdGggb2YgZmlsZSwgbGluZSBhbmQgbGluZSBudW1iZXIgaW4gd2hpY2ggdGhlIGdpdmVuIHRleHQgaXMgcHJlc2VudC5cclxuICovXHJcbmNvbnN0IHNlYXJjaExpbmVCeUxpbmUgPSAoXHJcbiAgZmlsZVBhdGg6IHN0cmluZyxcclxuICB0ZXh0VG9TZWFyY2g6IHN0cmluZyxcclxuICBvcHRpb25zOiBTZWFyY2hPcHRpb25zLFxyXG4pID0+IHtcclxuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgY29uc3QgcmVzdWx0czogTGluZVJlc3VsdFtdID0gW107XHJcbiAgICBjb25zdCBzdHJlYW0gPSBjcmVhdGVSZWFkU3RyZWFtKGZpbGVQYXRoLCB7IGVuY29kaW5nOiAndXRmLTgnIH0pO1xyXG4gICAgY29uc3QgbGluZVJlYWRlciA9IGNyZWF0ZUludGVyZmFjZSh7XHJcbiAgICAgIGlucHV0OiBzdHJlYW0sXHJcbiAgICB9KTtcclxuXHJcbiAgICBsZXQgbGluZU5vID0gMDtcclxuXHJcbiAgICBsaW5lUmVhZGVyLm9uKCdsaW5lJywgKGxpbmUpID0+IHtcclxuICAgICAgbGluZU5vKys7XHJcbiAgICAgIGlmIChzZWFyY2gobGluZSwgdGV4dFRvU2VhcmNoLCBvcHRpb25zKSkge1xyXG4gICAgICAgIHJlc3VsdHMucHVzaCh7IGZpbGVQYXRoLCBsaW5lOiBsaW5lLnRyaW0oKSwgbGluZU5vIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBsaW5lUmVhZGVyLm9uKCdjbG9zZScsICgpID0+IHtcclxuICAgICAgcmVzb2x2ZShyZXN1bHRzKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGxpbmVSZWFkZXIub24oJ2Vycm9yJywgKGVycikgPT4ge1xyXG4gICAgICBzdHJlYW0uY2xvc2UoKTtcclxuICAgICAgcmVqZWN0KGVycik7XHJcbiAgICB9KTtcclxuICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBNZXRob2QgdG8gcmVhZCB0aGUgZ2l2ZW4gZmlsZSBhbmQgc2VhcmNoIGZvciB0aGUgZ2l2ZW4gdGV4dC5cclxuICpcclxuICogQHBhcmFtIHtzdHJpbmd9IGZpbGVQYXRoIFBhdGggb2YgdGhlIGZpbGUgdG8gc2VhcmNoLlxyXG4gKiBAcGFyYW0ge3N0cmluZ30gdGV4dFRvU2VhcmNoIFRleHQgdG8gc2VhcmNoIGluIGZpbGUuXHJcbiAqIEBwYXJhbSB7b2JqZWN0fSBvcHRpb25zIFZhcmlvdXMgb3B0aW9ucyBmb3IgZmlsZSBzZWFyY2guXHJcbiAqIEByZXR1cm5zIHtwcm9taXNlfSBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdpdGggcGF0aCBvZiBmaWxlIGluIHdoaWNoIHRoZSBnaXZlbiB0ZXh0IGlzIHByZXNlbnQuXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgcmVhZEZpbGVBbmRTZWFyY2ggPSAoXHJcbiAgZmlsZVBhdGg6IHN0cmluZyxcclxuICB0ZXh0VG9TZWFyY2g6IHN0cmluZyxcclxuICBvcHRpb25zOiBTZWFyY2hPcHRpb25zLFxyXG4pID0+IHtcclxuICBpZiAoIW9wdGlvbnMuc2VhcmNoUmVzdWx0cyB8fCBvcHRpb25zLnNlYXJjaFJlc3VsdHMgIT09ICdsaW5lTm8nKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICBjb25zdCByZWFkU3RyZWFtID0gY3JlYXRlUmVhZFN0cmVhbShmaWxlUGF0aCwgeyBlbmNvZGluZzogJ3V0Zi04JyB9KTtcclxuXHJcbiAgICAgIHJlYWRTdHJlYW0ub24oJ2RhdGEnLCAoZGF0YSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IHNlYXJjaChkYXRhLnRvU3RyaW5nKCksIHRleHRUb1NlYXJjaCwgb3B0aW9ucyk7XHJcbiAgICAgICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgICAgcmVzb2x2ZShmaWxlUGF0aCk7XHJcbiAgICAgICAgICByZWFkU3RyZWFtLmNsb3NlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHJlYWRTdHJlYW0ub24oJ2Vycm9yJywgKGVycikgPT4ge1xyXG4gICAgICAgIHJlYWRTdHJlYW0uY2xvc2UoKTtcclxuICAgICAgICByZWplY3QoZXJyKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICByZWFkU3RyZWFtLm9uKCdjbG9zZScsIHJlc29sdmUpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG4gIHJldHVybiBzZWFyY2hMaW5lQnlMaW5lKGZpbGVQYXRoLCB0ZXh0VG9TZWFyY2gsIG9wdGlvbnMpO1xyXG59O1xyXG4iXX0=